<!DOCTYPE html>

<html lang="en" data-bs-theme="dark">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- bootstrap -->
        <link href="./lib/ui/bootstrap/bootstrap.min.css" rel="stylesheet" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
        <script src="./lib/ui/bootstrap/bootstrap.bundle.min.js"></script>

        <title>AI Follower Framework</title>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@11.7.0/styles/default.min.css" />
        <!-- always have a css file to override things -->
        <link rel="stylesheet" href="css/style_new.css" /> 

        <script src="https://unpkg.com/@highlightjs/cdn-assets@11.7.0/highlight.min.js"></script>
        <script src="https://unpkg.com/@highlightjs/cdn-assets@11.7.0/languages/javascript.min.js"></script>

        <script>
            function togglePre(element) {
                if (element.parentElement.lastChild.className == "") element.parentElement.lastChild.className = "foldable";
                else element.parentElement.lastChild.className = "";
            }

            function toggleDP() {
                document.querySelector(".debugpane").classList.toggle("d-none");
            }
            
            function checkRetVal(json) {
                if (json.status==0) {
                    alert("URL seems ok and available.");
                    console.log("Connection info: (This test only tests connection, so you can get 40x/50x Headers. It's normal.)",json.info)
                } else  if (json.status==1) {
                    alert("URL seems ok, but cannot connect. Debug info:"+json.info)
                } else  if (json.status==2) {
                    alert("URL seems wrong and malformed: "+json.info)
                }
                document.body.style.cursor=""
                document.body.style.opacity=1
                console.log(json);
                return true;
            }
            function checkUrlFromServer(formFieldName) {
                document.body.style.cursor="wait";
                document.body.style.opacity=0.5;
                ele=document.querySelector("input[name='"+formFieldName+"']");
                console.log(ele.value);
                fetch('tools/check_url.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({"url": ele.value})
                })
                .then(response => response.json())
                .then(json => checkRetVal(json))

            }
            
            function getAnchor() {
                var urlString = window.location.href;
                var url = new URL(urlString);
                var anchor = url.hash;
                return anchor
            }
            
            function getAnchorNH() {
                var urlString = window.location.href;
                var url = new URL(urlString);
                var anchor = url.hash;
                return anchor.substring(1);
            }
            
            function scrollToHash() {
                // Get the hash from the URL
                var hash = getAnchorNH()

                // Check if there's a hash
                if (hash) {
                    // Find the element with the corresponding id
                    var element = document.getElementById(hash);

                    // Check if the element exists
                    if (element) {
                        // Scroll to the element
                        element.scrollIntoView();
                    }
                }
            }
            
             function callHelper(helper) {
                document.body.style.cursor="wait";
                form=document.querySelector(".confwizard")
                var inputs = form.querySelectorAll('input');
                const formData = {};

      
      
                inputs.forEach(input => {
                    formData[input.name] = input.value;
                });
                
                inputs = form.querySelectorAll('textarea');
                inputs.forEach(input => {
                    formData[input.name] = input.value;
                });

                fetch("cmd/"+helper, {
                    method: 'POST',
                    headers: {
                    'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                })
                .then(response => {
                    if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Success:', data);
                    for (let key in data) {
                        if (data.hasOwnProperty(key)) {
                            //console.log(`${key}: ${data[key]}`);
                            t=document.querySelector("input[name='"+key+"']")
                            if (t) {
                                t.value=data[key]
                                t.animate(
                                    [
                                        // fotogramas clave
                                        { color: "white" },
                                        { color: "red" }
                                    ],
                                    {
                                        // opciones de sincronización
                                        duration: 1000,
                                        iterations: 3
                                    }
                                );
                            } else {
                                t=document.querySelector("textarea[name='"+key+"']")
                                t.value=data[key]
                                t.animate(
                                    [
                                        // fotogramas clave
                                        { color: "white" },
                                        { color: "red" }
                                    ],
                                    {
                                        // opciones de sincronización
                                        duration: 1000,
                                        iterations: 3
                                    }
                                );
                            
                            }
                        }
                    }
                    document.body.style.cursor="";

                })
                .catch(error => {
                    console.error('There has been a problem with your fetch operation:', error);
                    document.body.style.cursor="";
                });
      
                
            }
            
        </script>
    </head>
    <body>
